<!DOCTYPE html>
<html>
<head>
    <title>Телефонный справочник</title>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .actions {
            margin-bottom: 20px;
        }

        .actions button,
        .actions form {
            display: inline-block;
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .invalid {
            border: 2px solid red;
        }
    </style>
</head>
<body>

    <h1>Телефонный справочник</h1>

    {{if .ShowButtons}}
    <div class="actions">
        <button id="addBtn">Добавить запись</button>
        <button id="deleteBtn">Удалить запись</button>
        <button id="searchBtn">Поиск</button>

        <form action="/logout" method="POST" style="display: inline;">
            <input type="submit" value="Выйти">
        </form>
    </div>
    {{else}}
    <div class="actions">
        <button id="searchBtn">Поиск</button>

        <form action="/logout" method="POST" style="display: inline;">
            <input type="submit" value="Выйти">
        </form>
    </div>
    {{end}}

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Организация</th>
                <th>Город</th>
                <th>Телефон</th>
            </tr>
        </thead>
        <tbody>
            {{range .Items}}
            <tr>
                <td>{{.Id}}</td>
                <td>{{.Organization}}</td>
                <td>{{.City}}</td>
                <td>{{.Phone}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>

    <!-- Модальное окно для добавления записи -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" id="addClose">&times;</span>
            <h3>Новая запись</h3>
            <form action="/add" method="POST" id="addForm">
                <label>Организация:</label><br>
                <input type="text" name="organization" id="orgInput" required><br>
                <label>Город:</label><br>
                <input type="text" name="city" id="cityInput" required><br>
                <label>Телефон (+7-xxx-xxx-xx-xx):</label><br>
                <input type="text" name="phone" id="phoneInput" required><br><br>
                <button type="submit" id="saveBtn" disabled>Сохранить</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно для удаления записи -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" id="deleteClose">&times;</span>
            <h3>Удалить запись</h3>
            <form action="/delete" method="POST">
                <label>ID записи:</label><br>
                <input type="number" name="id" required><br><br>
                <button type="submit">Удалить</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно для поиска -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <span class="close" id="searchClose">&times;</span>
            <h3>Поиск записи</h3>
            <form id="searchForm" action="/search" method="POST">
                <label>Организация:</label><br>
                <input type="text" name="organization"><br>
                <label>Город:</label><br>
                <input type="text" name="city"><br>
                <label>Телефон:</label><br>
                <input type="text" name="phone"><br><br>
                <button type="submit">Поиск</button>
            </form>
            <form action="/return" method="POST" style="display: inline;">
                <input type="submit" value="Очистить">
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Модальные окна
            const modals = {
                add: document.getElementById("addModal"),
                delete: document.getElementById("deleteModal"),
                search: document.getElementById("searchModal")
            };

            const buttons = {
                add: document.getElementById("addBtn"),
                delete: document.getElementById("deleteBtn"),
                search: document.getElementById("searchBtn")
            };

            const closes = {
                add: document.getElementById("addClose"),
                delete: document.getElementById("deleteClose"),
                search: document.getElementById("searchClose")
            };

            if (buttons.add && closes.add) {
                buttons.add.onclick = () => modals.add.style.display = "block";
                closes.add.onclick = () => modals.add.style.display = "none";
            }

            if (buttons.delete && closes.delete) {
                buttons.delete.onclick = () => modals.delete.style.display = "block";
                closes.delete.onclick = () => modals.delete.style.display = "none";
            }

            if (buttons.search && closes.search) {
                buttons.search.onclick = () => modals.search.style.display = "block";
                closes.search.onclick = () => modals.search.style.display = "none";
            }

            window.onclick = function(event) {
                for (let key in modals) {
                    if (event.target === modals[key]) {
                        modals[key].style.display = "none";
                    }
                }
            };

            // Валидация формы добавления
            const orgInput = document.getElementById("orgInput");
            const cityInput = document.getElementById("cityInput");
            const phoneInput = document.getElementById("phoneInput");
            const saveBtn = document.getElementById("saveBtn");

            function validateForm() {
                const phoneRegex = /^\+7-\d{3}-\d{3}-\d{2}-\d{2}$/;
                const isValidPhone = phoneRegex.test(phoneInput.value);

                phoneInput.classList.toggle('invalid', !isValidPhone);

                const isFilled = orgInput.value.trim() !== "" && cityInput.value.trim() !== "";
                saveBtn.disabled = !(isFilled && isValidPhone);
            }

            [orgInput, cityInput, phoneInput].forEach(input => {
                input.addEventListener("input", validateForm);
            });
        });
    </script>

</body>
</html>
